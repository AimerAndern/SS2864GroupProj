---
title: "total"
author: "ryang273"
date: "26/11/2020"
output: html_document
---
```{r}
library(reshape2)
library(tidyverse)
library(ggplot2)
Confirmed <- read_csv("/Users/yangruiqin/Desktop/2864/time_series_covid19_confirmed_global.csv")
Recovered <- read_csv("/Users/yangruiqin/Desktop/2864/time_series_covid19_recovered_global.csv")
Confirmed_data <- Confirmed %>%
  group_by(`Country/Region`) %>%
  summarise(Confirmed = sum(`11/22/20`, na.rm = TRUE)) %>%
  rename(Region = `Country/Region`)
Recovered_data <- Recovered %>%
  group_by(`Country/Region`) %>%
  summarise(Recovered = sum(`11/22/20`, na.rm = TRUE)) %>%
  rename(Region = `Country/Region`)
data.confirmed <- Confirmed_data %>%
  select(Region, Confirmed,) %>%
  mutate(ranking = dense_rank(desc(Confirmed)))
top.countries_confirmed <- data.confirmed %>% filter(ranking <= 10) %>%
  arrange(ranking) %>% pull(Region) %>% as.character()
top.countries_confirmed  %>% print()
data.recovered <- Recovered_data %>%
  select(Region, Recovered,) %>%
  mutate(ranking = dense_rank(desc(Recovered)))
top.countries_recovered <- data.recovered %>% filter(ranking <= 10) %>%
  arrange(ranking) %>% pull(Region) %>% as.character()
top.countries_recovered  %>% print()
rank.countries_confirmed <- global[order(global$Confirmed,decreasing= T),]
top.countries_confirmed <- head(rank.countries_confirmed, 15)
top.countries_confirmed
overall <- top.countries_confirmed %>% 
  melt(id.vars = "Region", 
       measure.vars = c("Confirmed"))
options(scipen=220)
p1 <- ggplot(overall) + 
  geom_bar(aes(x = Region, y = value, fill = variable), 
           stat = "identity", position="identity") +geom_text(aes(x = Region, y = value,label = value),size = 2,vjust = 1.5)+
  theme(axis.text.x = element_text(angle = 45, hjust=0.5)) + 
  labs(title = "Cases in Top 15 Countries", x = "Region", y = "") + 
  guides(fill = guide_legend(title = NULL)) +
  scale_fill_discrete(labels = c("Confirmed"))
overall_recover <- top.countries_confirmed %>% 
  melt(id.vars = "Region", 
       measure.vars = c("Recovered"))
p2 <- ggplot(overall_recover) + 
  geom_bar(aes(x = Region, y = value, fill = variable), 
           stat = "identity", position="identity") +geom_text(aes(x = Region, y = value,label = value),size = 2,vjust = 1.5)+
  theme(axis.text.x = element_text(angle = 45, hjust=0.5)) + 
  labs(title = "Recovered cases in Top 15 Countries", x = "Region", y = "") + 
  guides(fill = guide_legend(title = NULL)) +
  scale_fill_discrete(labels = c("Recovered"))
new <-  top.countries_confirmed%>%mutate(recover.rate=(100 * Recovered/Confirmed) %>% round(1))
new
new_overall <- new %>% 
  melt(id.vars = "Region", 
       measure.vars = c("recover.rate"))
new_overall
p3 <- ggplot(new_overall) + 
  geom_bar(aes(x = Region, y =value , fill=variable), 
           stat = "identity", position="identity") +geom_text(aes(x = Region, y = value,label = value),size = 3)+
  theme(axis.text.x = element_text(angle = 45, hjust=0.5)) + 
  labs(title = "Recover rate(%) in Top 15 Countries", x = "Region", y = "") + 
  guides(fill = guide_legend(title = NULL)) +
  scale_fill_discrete(labels = c("Recover rate(%)"))
p3
multiplot(p1, p2,p3, cols = 2)
```

